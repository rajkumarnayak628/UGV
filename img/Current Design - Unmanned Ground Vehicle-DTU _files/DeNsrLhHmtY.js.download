if (self.CavalryLogger) { CavalryLogger.start_js(["IH4QJ"]); }

__d("MMercurySyncNewMessageTransformer",["IrisProtocolMessageLifetime","MercuryActionType","MercuryIDs","MercuryMessageCustomizations","MercuryProfileRanges","MercuryTimestamp","MessagingTag"],(function a(b,c,d,e,f,g,h,i,j,k,l,m,n){"use strict";__p&&__p();var o=function o(q){var r={};try{r=JSON.parse(q)}catch(s){}return r instanceof Array?r[0]:r};function p(q,r){var s=parseInt(r.messageMetadata.timestamp,10),t=m.getFormatedTimestamp(s),u=r.messageMetadata.skipBumpThread,v=q!==r.messageMetadata.actorFbId,w=[];if(r.attachments)w=r.attachments.map(function(y){return y.mercury});var x=r.messageMetadata.tags?r.messageMetadata.tags[0]:undefined;return{message_id:r.messageMetadata.messageId,threading_id:null,offline_threading_id:r.messageMetadata.offlineThreadingId,author:j.getParticipantIDFromUserID(r.messageMetadata.actorFbId),author_email:r.messageMetadata.actorFbId+"@facebook.com",ephemeral_ttl_mode:r.ttl?h[r.ttl]:0,timestamp:s,is_unread:v,is_filtered_content:false,is_filtered_content_bh:false,is_filtered_content_account:false,is_filtered_content_quasar:false,is_filtered_content_invalid_app:false,source:x,tags:r.messageMetadata.tags,is_spoof_warning:false,folder:n.INBOX,thread_fbid:r.messageMetadata.threadKey.threadFbId,other_user_fbid:r.messageMetadata.threadKey.otherUserFbId,body:r.body!==undefined?r.body:"",html_body:null,subject:null,has_attachment:w.length>0,attachments:w,ranges:undefined,thread_id:null,action_type:i.USER_GENERATED_MESSAGE,is_from_iris:true,is_sponsored:!!(r.data&&r.data.is_sponsored&&r.data.is_sponsored==="true")||!!(r.untypedData&&r.untypedData.is_sponsored&&r.untypedData.is_sponsored==="true"),commerce_message_type:r.data?r.data.commerce_message_type:null,customizations:r.data&&r.data.customization?k.parseCustomizations(r.data.customization):null,platform_xmd:r.data&&r.data.platform_xmd?r.data.platform_xmd:null,profile_ranges:l.extractFromDelta(r),message_source:r.data&&r.data.message_source_data?o(r.data.message_source_data).message_source:null,skip_bump_thread:u,montage_reply_data:r.data&&r.data.montage_reply_data?o(r.data.montage_reply_data):null,meta_ranges:r.data&&r.data.meta_ranges?o(r.data.meta_ranges):null}}f.exports={transform:p}}),null);